---
type: basic-note
title: mock-spy-stub-区别
author: JackyLee
create_time: 2025-11-03
update_time:
tags:
description: 主要讲述 Mock Spy 和 Stub 的主要区别
---

## Mock

完全模拟对象，所有方法调用默认无行为（返回 null/0/false），只有你明确声明的交互才有响应。
用于隔离被测对象，只关心方法是否被调用、参数、返回值等。
不会执行真实方法体，除非特别指定。
适合只验证交互，不关心实现的场景。

```groovy
def service = Mock(UserService)
1 * service.getUser(1) >> new User(1, "foo") // 断言调用一次且返回指定结果
```

> 默认无行为 + 指定 Mock 部分方法
> Mock 完全模拟，默认不执行真实代码，只关心交互。

## Stub

用途：用于提供方法的预设返回值，隔离外部依赖。
行为：只关心返回什么，不关心方法是否被调用或调用次数。
特点：关注“给什么就返回什么”，不验证交互。
常用场景：需要为依赖设置固定返回值，但不关心调用细节。

```groovy
def service = Stub(UserService)
service.getUser(1) >> new User(1, "foo") // 只关心返回，不关心调用次数
```

## Spy

部分模拟对象，默认会执行真实方法体，除非你明确声明某个方法要拦截/替换。
用于部分模拟，即你希望对象大部分行为真实，只对某些方法进行 Mock。
适合需要验证调用、又想保留部分真实逻辑的场景，比如数据库、文件等副作用操作。

```groovy
def list = Spy(ArrayList)
list.get(0) >> "foo" // 只有get(0)被替换，其他方法真实执行
```

> 默认真实行为 + 指定 Mock 方法
> Spy：部分模拟，默认执行真实代码，只拦截你指定的行为。

| 特性     | Mock                 | Stub       | Spy                 |
| -------- | -------------------- | ---------- | ------------------- |
| 默认行为 | 无行为               | 无行为     | 执行真实方法        |
| 交互验证 | 支持（如调用次数等） | 不支持     | 支持                |
| 返回值   | 需声明               | 需声明     | 可声明              |
| 真实逻辑 | 不执行               | 不执行     | 默认执行            |
| 适用场景 | 交互验证             | 预设返回值 | 部分替换/副作用验证 |

## 参考资料
